<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Form view inherit -->
    <record id="view_move_form_inherit"
            model="ir.ui.view"
    >
        <field name="name">l10n.hu.plus.view.move.form.inherit</field>
        <field name="inherit_id"
               ref="account.view_move_form"
        />
        <field name="model">account.move</field>
        <field name="priority">36</field>
        <field name="arch"
               type="xml"
        >
            <!-- HU+ banner -->
            <xpath expr="//div[1]"
                   position="before"
            >
                <div name="l10n_hu_plus_div"
                     class="border font-weight-bold mb-2 p-1 text-uppercase"
                     invisible="not l10n_hu_plus_enabled or not l10n_hu_banner_enabled"
                >
                    <div name="l10n_hu_info"
                         class="d-inline ms-2"
                    >
                        <span name="hu_flag">
                            <img src="/l10n_hu_plus/static/description/hu_flag.png"
                                 alt="HU Flag"
                                 class="p-0"
                                 width="36px"
                            />
                        </span>
                        <span name="action_l10n_hu_plus_documentation">
                            <button name="action_l10n_hu_plus_documentation"
                                    class="btn-link"
                                    groups="l10n_hu_plus.user_group"
                                    string="HU+"
                                    type="object"
                            />
                        </span>
                    </div>
                    <div name="l10n_hu_details"
                         class="d-inline"
                    >
                        <span name="l10n_hu_proforma_name"
                              class="ms-2 me-2"
                              invisible="not l10n_hu_proforma_date or not l10n_hu_proforma_name"
                        >
                            <field name="l10n_hu_proforma_name"
                                   readonly="1"
                                   string="Proforma"
                            />
                        </span>
                        <span name="action_l10n_hu_send_proforma"
                              class="ms-2"
                              invisible="state != 'draft' or not l10n_hu_proforma_sequence"
                        >
                            <button name="action_l10n_hu_send_proforma"
                                    class="btn-secondary btn-sm"
                                    groups="l10n_hu_plus.user_group"
                                    icon="fa-send"
                                    string="Proforma Send"
                                    type="object"
                            />
                        </span>
                    </div>
                </div>
            </xpath>
            <!-- HU+ fields -->
            <xpath expr="//page[@name='aml_tab']"
                   position="after"
            >
                <page name="l10n_hu_plus"
                      invisible="not l10n_hu_plus_enabled"
                      string="HU+"
                >
                    <group name="l10n_hu_plus">
                        <group name="l10n_hu_plus_1"
                               invisible="l10n_hu_journal_type not in ['purchase', 'sale']"
                        >
                            <!-- Document type -->
                            <field name="l10n_hu_document_type"
                                   options="{'no_create': True,}"
                                   readonly="state != 'draft' and not to_check"
                                   string="Document Type"
                            />
                            <!-- Original invoice -->
                            <label name="l10n_hu_original_invoice"
                                   for="l10n_hu_original_invoice_number"
                                   string="Original Invoice Number"
                            />
                            <div name="l10n_hu_original_invoice">
                                <field name="l10n_hu_original_invoice_number"
                                       class="oe_inline"
                                       readonly="state != 'draft' and not to_check"
                                />
                                <button name="action_l10n_hu_view_original_invoice"
                                        class="oe_inline btn-sm btn-link"
                                        icon="fa-folder-open"
                                        invisible="not l10n_hu_original_invoice_number"
                                        string="View"
                                        type="object"
                                />
                            </div>
                            <field name="l10n_hu_original_account_move"
                                   invisible="1"
                            />
                            <!-- Delivery period -->
                            <label name="l10n_hu_delivery_period"
                                   for="l10n_hu_delivery_period_start"
                                   string="Delivery Period"
                            />
                            <div name="l10n_hu_delivery_period">
                                <field name="l10n_hu_delivery_period_start"
                                       class="oe_inline o_input_10ch"
                                       placeholder="Period Start"
                                       readonly="state != 'draft' and not to_check"
                                />
                                <span class="ps-2 pe-2">-</span>
                                <field name="l10n_hu_delivery_period_end"
                                       class="oe_inline o_input_10ch"
                                       placeholder="Period End"
                                       readonly="state != 'draft' and not to_check"
                                />
                                <field name="l10n_hu_delivery_period_summary"
                                       invisible="l10n_hu_journal_type != 'sale'"
                                />
                                <field name="l10n_hu_delivery_period_legal"
                                       invisible="l10n_hu_journal_type != 'sale'"
                                />
                                <button name="action_l10n_hu_refresh_delivery_period"
                                        class="oe_inline btn-sm btn-link"
                                        icon="fa-refresh"
                                        invisible="state != 'draft' or l10n_hu_journal_type != 'sale' or not l10n_hu_delivery_period_start or not l10n_hu_delivery_period_end"
                                        string="Refresh"
                                        type="object"
                                />
                            </div>
                        </group>
                        <group name="l10n_hu_plus_2"
                               invisible="l10n_hu_journal_type not in ['purchase', 'sale']"
                        >
                            <!-- VAT -->
                            <field name="l10n_hu_vat_date"
                                   readonly="state != 'draft' and not to_check"
                                   string="VAT Date"
                            />
                            <!-- Cash accounting -->
                            <field name="l10n_hu_cash_accounting"
                                   force_save="1"
                                   readonly="state != 'draft' and not to_check"
                                   string="Cash Accounting"
                            />
                            <!-- Currency -->
                            <label name="l10n_hu_document_rate"
                                   for="l10n_hu_document_rate"
                                   invisible="currency_id == company_currency_id"
                                   string="Document Rate"
                            />
                            <div name="l10_hu_document_rate"
                                 invisible="currency_id == company_currency_id"
                            >
                                <field name="l10n_hu_document_rate"
                                       class="oe_inline"
                                       readonly="state != 'draft' and not to_check"
                                />
                                <button name="action_l10n_hu_wizard_currency_exchange"
                                        class="oe_inline btn-sm btn-link"
                                        icon="fa-calculator"
                                        string="Currency Exchange"
                                        type="object"
                                />
                            </div>
                            <label name="l10n_hu_accounting_rate"
                                   for="l10n_hu_currency_rate"
                                   invisible="currency_id == company_currency_id"
                                   string="Accounting Rate"
                            />
                            <div name="l10n_hu_accounting_rate"
                                 invisible="currency_id == company_currency_id"
                            >
                                <field name="l10n_hu_currency_rate"
                                       class="oe_inline"
                                />
                                <field name="l10n_hu_currency_name"
                                       class="oe_inline ps-2 pe-2"
                                />
                                <field name="l10n_hu_currency_date"
                                       class="oe_inline"
                                />
                            </div>
                            <field name="l10n_hu_rate_difference"
                                   invisible="currency_id == company_currency_id"
                                   string="Rate Difference"
                            />
                        </group>
                        <group name="l10n_hu_plus_proforma"
                               invisible="l10n_hu_journal_type != 'sale' or not l10n_hu_proforma_sequence"
                               string="Proforma"
                        >
                            <field name="l10n_hu_proforma_name"
                                   readonly="state != 'draft' and not to_check"
                                   string="Proforma Name"
                            />
                            <field name="l10n_hu_proforma_date"
                                   readonly="state != 'draft' and not to_check"
                                   string="Proforma Date"
                            />
                            <label name="l10n_hu_proforma_actions"
                                   for="action_l10n_hu_send_proforma"
                                   string="Actions"
                            />
                            <div name="l10n_hu_proforma_actions">
                                <button name="action_l10n_hu_send_proforma"
                                        class="btn-link text-left"
                                        groups="l10n_hu_plus.user_group"
                                        icon="fa-send"
                                        invisible="state != 'draft' or not l10n_hu_proforma_sequence"
                                        string="Proforma Send"
                                        type="object"
                                />
                            </div>
                        </group>
                        <group name="l10n_hu_plus_partner"
                               invisible="l10n_hu_journal_type not in ['purchase', 'sale']"
                               string="Partner"
                        >
                            <!-- Partner -->
                            <field name="l10n_hu_fiscal_representative"
                                   invisible="l10n_hu_journal_type not in ['purchase', 'sale']"
                                   options="{'no_create': True,}"
                                   readonly="state != 'draft' and not to_check"
                                   string="Fiscal Representative"
                            />
                            <field name="l10n_hu_fiscal_representative_bank_account"
                                   domain="[('partner_id', '=', l10n_hu_fiscal_representative)]"
                                   invisible="l10n_hu_journal_type not in ['purchase', 'sale']"
                                   options="{'no_create': True,}"
                                   readonly="state != 'draft' and not to_check"
                                   string="Fiscal Representative Bank Account"
                            />
                            <field name="l10n_hu_company_partner"
                                   string="Company Partner"
                            />
                            <field name="l10n_hu_partner_country"
                                   string="Partner Country"
                            />
                        </group>
                        <group name="l10n_hu_plus_journal"
                               string="Journal"
                        >
                            <field name="l10n_hu_plus_enabled"
                                   string="HU+"
                            />
                            <field name="l10n_hu_banner_enabled"
                                   string="Banner"
                            />
                            <field name="l10n_hu_proforma_sequence"
                                   invisible="not l10n_hu_proforma_sequence"
                                   string="Proforma Sequence"
                            />
                            <field name="l10n_hu_journal_type"
                                   string="Journal Type"
                            />
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
    <!-- List view inherit  -->
    <record id="view_invoice_tree_inherit"
            model="ir.ui.view"
    >
        <field name="name">l10n.hu.account.view.invoice.tree.inherit</field>
        <field name="inherit_id"
               ref="account.view_invoice_tree"
        />
        <field name="model">account.move</field>
        <field name="priority">36</field>
        <field name="arch"
               type="xml"
        >
            <!-- Add proforma -->
            <field name="name"
                   position="after"
            >
                <field name="l10n_hu_proforma_name"
                       optional="hide"
                       readonly="state in ['cancel', 'posted']"
                       string="Proforma Name"
                />
            </field>
            <!-- Add delivery date -->
            <field name="date"
                   position="after"
            >
                <field name="delivery_date"
                       optional="hide"
                       readonly="state in ['cancel', 'posted']"
                       string="Delivery Date"
                />
            </field>
            <!-- HU fields -->
            <xpath expr="//field[@name='date']"
                   position="before"
            >
                <field name="l10n_hu_partner_country"
                       optional="hide"
                />
                <field name="l10n_hu_trade_position"
                       optional="hide"
                       string="Trade Position"
                />
            </xpath>
            <!-- HU fields -->
            <xpath expr="//field[@name='date']"
                   position="after"
            >
                <field name="l10n_hu_vat_date"
                       optional="hide"
                       string="VAT Date"
                />
            </xpath>
        </field>
    </record>
    <!-- Search view inherit  -->
    <record id="view_account_invoice_filter_inherit"
            model="ir.ui.view"
    >
        <field name="name">l10n.hu.account.view.account.invoice.filter.inherit</field>
        <field name="inherit_id"
               ref="account.view_account_invoice_filter"
        />
        <field name="model">account.move</field>
        <field name="priority">36</field>
        <field name="arch"
               type="xml"
        >
            <!-- Field -->
            <xpath expr="//field[@name='name'][1]"
                   position="attributes"
            >
                <attribute name="filter_domain">['|', '|' , '|', '|', '|',
                    ('name', 'ilike', self), ('invoice_origin', 'ilike', self),
                    ('ref', 'ilike', self), ('payment_reference', 'ilike', self),
                    ('partner_id', 'child_of', self),('l10n_hu_proforma_name', 'ilike', self)]
                </attribute>
            </xpath>
            <xpath expr="//field[@name='payment_reference']"
                   position="after"
            >
                <field name="l10n_hu_proforma_name"/>
            </xpath>
            <!-- Filter -->
            <xpath expr="//filter[@name='invoice_date']"
                   position="after"
            >
                <filter name="delivery_date_filter"
                        date="delivery_date"
                        string="Delivery Date"
                />
            </xpath>
            <xpath expr="//filter[@name='due_date']"
                   position="after"
            >
                <separator/>
                <filter name="l10n_hu_vat_date_filter"
                        date="l10n_hu_vat_date"
                        string="VAT Date"
                />
                <filter name="l10n_hu_proforma_date_filter"
                        date="l10n_hu_proforma_date"
                        string="Proforma Date"
                />
                <separator/>
                <filter name="l10n_hu_proforma_sent_filter"
                        domain="[('l10n_hu_proforma_date', '!=', False), ('l10n_hu_proforma_name', '!=', False)]"
                        string="Proforma Sent"
                />
                <separator/>
                <filter name="l10n_hu_trade_position_domestic_filter"
                        domain="[('l10n_hu_trade_position', '=', 'domestic')]"
                        string="Domestic"
                />
                <filter name="l10n_hu_trade_position_eu_filter"
                        domain="[('l10n_hu_trade_position', '=', 'eu')]"
                        string="EU"
                />
                <filter name="l10n_hu_trade_position_other_filter"
                        domain="[('l10n_hu_trade_position', '=', 'other')]"
                        string="Other"
                />
                <filter name="l10n_hu_trade_position_none_filter"
                        domain="[('l10n_hu_trade_position', '=', False)]"
                        string="No Trade Position"
                />
            </xpath>
            <!-- Filter group by -->
            <xpath expr="//filter[@name='invoicedate']"
                   position="after"
            >
                <filter name="delivery_date_filter_group_by"
                        context="{'group_by': 'delivery_date'}"
                        string="Delivery Date"
                />
            </xpath>
            <xpath expr="//filter[@name='group_by_sequence_prefix']"
                   position="after"
            >
                <separator/>
                <filter name="l10n_hu_vat_date_filter_group_by"
                        context="{'group_by': 'l10n_hu_vat_date'}"
                        string="VAT Date"
                />
                <filter name="l10n_hu_proforma_date_filter_group_by"
                        context="{'group_by': 'l10n_hu_proforma_date'}"
                        string="Proforma Date"
                />
                <separator/>
                <filter name="l10n_hu_partner_country_filter_group_by"
                        context="{'group_by': 'l10n_hu_partner_country'}"
                        string="Partner Country"
                />
                <filter name="l10n_hu_trade_position_filter_group_by"
                        context="{'group_by': 'l10n_hu_trade_position'}"
                        string="Trade Position"
                />
                <filter name="partner_id_filter_group_by"
                        context="{'group_by': 'partner_id'}"
                        string="Partner"
                />
            </xpath>
        </field>
    </record>
</odoo>
